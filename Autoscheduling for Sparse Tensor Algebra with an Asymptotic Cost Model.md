# Autoscheduling for Sparse Tensor Algebra with an Asymptotic Cost Model

# 稀疏张量代数的渐近成本模型自动调度

---

## 关键词

张量、稀疏、自动、调度、成本模型

---

## 核心思想

核心是一个渐近成本模型，该模型可以自动分析和排序所有可能的程序输入下稀疏张量调度的复杂度。

---

## 主要工作

首次提出了针对稀疏张量程序的自动渐近调度器。提供了一种抽象地表示调度渐近成本并进行选择的方法。将搜索空间缩小到一个可管理的、渐近非支配内核的帕累托前沿。

---

## 学到的知识点

1. **循环重排序和融合的局限性**：对密集张量程序的常数因子性能产生重大影响，但对稀疏张量程序的影响是渐近的，在实践中通常会导致数量级的性能差异。

2. 稀疏张量编译器：稀疏张量编译器将机制（如何从高级描述生成代码）与策略（决定哪个高级描述最佳）分开。将策略留给用户，这对于非性能工程师的领域专家来说可能是一个负担。编写一个好的调度需要时间，尤其是在内核很多或用户不熟悉张量编译器的情况下。稀疏系统必须遵循密集系统，朝着自动调度方向发展。自动调度承诺了一条通往集成到 SciPy或 TensorFlow等高级系统中的现实路径。虽然稀疏张量编译器提高了性能工程师的生产力，但我们的自动调度器将提高领域专家的生产力。

3. 协议化具体索引表示法（简称 CIN-P）：一种精确的中间表示。具体索引表示法的扩展。用于在高级别实现稀疏张量程序，指定循环结构、临时张量和张量格式。该语言将存储格式与访问方式（协议）分离。

4. **任何成本模型都是准确性和复杂性之间的平衡**。简单的模型可能会对输入及其相互作用做出不切实际的假设（例如非零值均匀分布）。更复杂的模型可能在没有大量运行时信息的情况下不会产生有用的见解。

5. **成本模型没有考虑硬件组件**：例如缓存、向量单元以及多核或 GPU 处理器。我们认为这些因素与作者的渐近模型赋予我们的决策无关。作者的模型代表了调度完成的总工作量。缓存阻塞、循环展开或并行化和负载均衡策略不会改变总工作量，它们只影响常数因子，并且可能与循环顺序无关。将硬件功能的调优留作未来工作，但观察到作者工作中产生的调度提供了极好的起点。**当然，忽略常数因子会带来后果，但这些后果是有限的**。

6. **为什么选择一个调度方案在渐近意义优越被认为是正确的**：即使一个调度方案在渐近意义上优于另一个，它也可能在小输入上被另一个方案以有限的常数因子超越。另一方面，可能存在一类输入，在这些输入上，作者的渐近优越调度方案随着输入的增长以任意大的因子超越另一个方案，克服了任何常数因子差异。选择一个渐近劣势的调度方案可能是一个大错误，而选择渐近优越的调度方案充其量只是一个小的错误。从这个意义上说，一个渐近优越的调度方案可以被认为是安全的。作者将关于是否以及何时考虑渐近支配调度的问题留待将来研究。

7. **成本模型复杂度的考虑**：精确地考虑这些情况会使作者的模型过于复杂而无法使用，收益甚微。事实上，可能无法在任何成本之间进行选择。在启发式优化下优化最佳情况行为可能会导致一个容易受到最坏情况输入影响的计划。

8. **自动渐近分析**：Automatic Asymptotic Analysis，在自动调度器中完成，并使用一种算法。该算法使用协议化稀疏具体索引符号来计算输入张量程序的渐近复杂度。

9. **自动调度**：Autoscheduling，作者使用渐近成本模型构建了一个枚举式自动调度器。调度器首先做出更粗粒度的决策，例如 forall 和 where 语句的结构，然后逐步做出更细粒度的决策，例如张量和工作空间的格式和协议。

---

## 个人思考

本文是这18篇论文中少有的基本没考虑硬件设备而专注于高层次代码级别优化的论文。虽然本论文和之前的一样，仍然是针对某种情况，但这次不再是针对硬件设备，而是针对特定种类的程序——稀疏张量程序。基于稀疏张量程序的特点，提出渐近成本模型，从而提供了一种抽象地表示调度渐近成本并进行选择的方法。**该论文针对成本模型的复杂度与精确度之间的衡量、衡量指标的分析是非常值得我学习的**。鱼和熊掌往往不可兼得，如何合理化我的选择，需要合理的分析，至少在某一方面，我的分析是合理的。
